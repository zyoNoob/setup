#!/bin/bash

# Interactive search using ripgrep
# Searches file contents with live preview

[[ -n $1 ]] && cd "$1" # go to provided folder or noop

typeset RG_DEFAULT_COMMAND="rg -i -l --hidden --glob '!.git' --color=never"
typeset IFS=$'\n'
typeset selected=($(
    fzf \
    -m \
    -e \
    --ansi \
    --disabled \
    --reverse \
    --height=40% \
    --layout=reverse \
    --border \
    --print-query \
    --bind "change:reload:$RG_DEFAULT_COMMAND {q} || true" \
    --preview "bat --color=always --style=numbers --line-range=:300 {} 2>/dev/null || rg -i --color=always --context=3 --hidden --glob '!.git' {q} {} | head -100" \
    --preview-window=right:60%:wrap))

[ -n "${selected[1]}" ] && ${EDITOR:-vim} -c "/\\c${selected[0]}" "${selected[1]}"
